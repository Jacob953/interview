## Internet

- [Internet](#internet)
  - [01. 接口出现502的原因？怎么排查？](#01-接口出现502的原因怎么排查)
  - [02. 如果网页加载很慢，有哪些原因？](#02-如果网页加载很慢有哪些原因)
  - [03. 长连接和短连接](#03-长连接和短连接)
  - [04. TCP 和 HTTP 的保活有什么区别？](#04-tcp-和-http-的保活有什么区别)
  - [三层隔离有哪些？](#三层隔离有哪些)
  - [https如何加解密](#https如何加解密)
  - [SSL/TLS协议提供的服务主要](#ssltls协议提供的服务主要)
  - [tls原理](#tls原理)
  - [密钥协商过程——TLS握手](#密钥协商过程tls握手)
  - [ssl原理](#ssl原理)
  - [请求baidu.com 发生了什么](#请求baiducom-发生了什么)
  - [rpc和http的区别](#rpc和http的区别)
  - [http 1.1 和http 2.0的区别](#http-11-和http-20的区别)
  - [http etag请求头的作用](#http-etag请求头的作用)
  - [http1.1 保持长连接](#http11-保持长连接)
  - [https与http的区别](#https与http的区别)
  - [滑动窗口的概念以及应用?](#滑动窗口的概念以及应用)
  - [三次握手四次挥手过程](#三次握手四次挥手过程)
  - [mysql一个表有时间，用户，消息字段要求查每个用户最新一条消息](#mysql一个表有时间用户消息字段要求查每个用户最新一条消息)
  - [如果tcp握手没成功怎么办](#如果tcp握手没成功怎么办)
  - [auth2权限认证](#auth2权限认证)
  - [tcp怎么实现可靠的通信](#tcp怎么实现可靠的通信)
  - [tcp拥塞控制算？为什么需要拥塞避免？](#tcp拥塞控制算为什么需要拥塞避免)
  - [cookie可以设置什么？](#cookie可以设置什么)
  - [网络攻击,ddos攻击, 半连接攻击](#网络攻击ddos攻击-半连接攻击)
  - [websocket?](#websocket)
  - [http2.0实现原理](#http20实现原理)
  - [TCP三次握手，为什么需要? 如果第二次或者第三次握手去掉，会怎么样？](#tcp三次握手为什么需要-如果第二次或者第三次握手去掉会怎么样)

### 01. 接口出现502的原因？怎么排查？

- 原因：错误的网关，充当代理或网关时，服务器在尝试处理请求时未收到上游服务器的正确响应。而且，此错误可能会伪装成各种其他错误消息。
  > 通常并不意味着上游服务器已关闭（无响应网关/代理），而是上游服务器和网关/代理使用不一致的协议交换数据。
  1. 原始服务器无法正常工作：连通性问题，服务器停机，过载，流量过多等。
  2. 域名问题：
     - 当域无法正确确定 IP 地址。
     - 错误的 DNS 记录设置为域托管级别。
     - 对 DNS 所做的更改可能没有足够的时间在全球范围内传播。
     - 由于 TTL（生存时间）因素较慢。
  3. 请求被防火墙阻止（大多数情况，因为它可以阻止服务之间的请求）
  4. 浏览器错误：
     - 浏览器扩展，如 AdBlock
     - 浏览器版本过旧
- 排查：
  1. 通过跟踪路由或 ping 测试服务器的 IP，尝试找出上游服务器是否可访问。
  2. 使用 DNS 测试工具检查合格域名是否正确解析。
  3. 检查服务器或网站错误日志，以查看是否在服务器上引发了特定错误。
  4. 对于 WordPress 网站，请尝试临时重命名“ wp-content / plugins”文件夹，以排除可能导致该错误的插件。
  5. 检查防火墙日志是否有阻塞迹象。

### 02. 如果网页加载很慢，有哪些原因？

1. 先是一个用户慢，还是一群用户慢还是全部用户慢？
   - 一个用户慢：客户端网络宽带不足、本机CPU或内存被占满
   - 一群用户慢：找寻共同慢的特性
   - 全部用户慢：进行接下来的判断
2. 再判断是不是单个接口响应比较慢？
   - 是的：定位具体的业务
   - 不是：先看前端页面渲染耗时，前端的性能问题一般有：
     1. JS 阻塞请求：JS 代码出现问题，解析就会花费很长时间，这两个 JS 请求之间会出现一个很大的空隙，就会导致这段时间的资源加载都被阻塞住
     2. 接收数据时间过长：http请求的大部分时间应该花在后面几个阶段，比如等待响应和接收数据。
        - 但是，如果接收数据的时间太长了，长到数百毫秒甚至以秒计算的时候，那也是有问题的。这种情况一般是因为下载的内容太重了，例如大图片、大脚本等
        - 这类问题可以使用 GZIP 压缩、图片压缩或者 JS/CSS 的 minify 等手段来解决。
     3. 加载某个资源太慢：如果某个请求比其他的请求多出很多的时间，那么一般情况就是某个资源的加载太慢，导致了整个网页变慢，原因有可能是
        1. 资源在第三方站点上，他们很慢
        2. 这个资源太大了
        3. 这个资源使用的域名有问题
     4. 前端页面请求的资源过多：
        - onload 之前如果有几百行，速度自然会慢的
        - 如果请求的资源不存在，那么速度将会更慢
     5. 网页本身中包含了追踪或者是分析用户的工具，从而导致网页的加载时间变的慢，比如之前海盗湾中会给用户的电脑插入挖矿的 JS 脚本
     6. 后端代码问题，如代码冗余、数据库发生锁死、动态请求时间过长等
3. 必要时引入性能测试，编写性能测试脚本复现问题

### 03. 长连接和短连接

> 在 HTTP/1.0 中，默认使用的是短连接，但从 HTTP/1.1 起，默认使用长连接

长连接是相对于通常的短连接，较长时间保持客户端与服务端的连接状态。

- HTTP：
  - 长连接：
    - 只要任意一端没有明确提出断开连接，则保持 TCP 连接状态
    - 为 HTTP 流水线技术提供了可实现的基础，客户端可以先一次性发送多个请求，而在发送过程中不需先等待服务器的回应，服务器还是按照顺序响应
    - 为了避免资源浪费的情况，一旦超过定时器设置的时间，就会触发回调函数来释放该连接
  - 短连接：
    - 每次请求都要经过：建立 TCP -> 请求资源 -> 响应资源 -> 释放连接
- TCP：
  - 长连接：两端的 TCP 连接长时间没有数据交互，则会触发 TCP 保活机制，将探测报文发送给对端
    - 对端会正常响应，则 TCP 保活时间会被重置，等待下一个 TCP 保活时间的到来
    - 对端多次未响应，则 TCP 会报告该 TCP 连接已经死亡，断开 TCP 连接
  - 短连接：
    - 每次请求都要经过：三次挥手建立连接和四次挥手断开连接

长连接适合操作频繁，点对点的通讯，而且连接数不能太多情况；短连接适合并发量大，且每个用户无需频繁操作情况

### 04. TCP 和 HTTP 的保活有什么区别？

- TCP Keepalive 机制是由 TCP 层（内核态）实现的，确保该连接的有效性
- HTTP Keep-Alive 由应用层（用户态） 实现的，也被称为 HTTP 长连接，减少多次 TCP 连接建立和释放的开销



- 客户端等待两个最大数据段生命周期（Maximum segment lifetime，MSL）的时间后也会进入 CLOSED 状态
- TIME_WAIT 一定是发生在主动关闭的一方，主动关闭一方需要等待 2 * MSL 时间才会最终关闭
    - 原因：
        1. 防止被动关闭方的延迟数据被人窃取
            -  如果 sever 之前发送的数据 sequece10001 在网络中，还没有被接收
            -  client1 time_wait 后迅速关闭
            -  client2 正好用了 client1 的端口，这样 client2 就接收了这个 sequece10001，就给 client2 带来了麻烦
        2. 防止被动关闭方没有收到最后的 ACK
            - 如果 client1 time_wait 不够长，
            - 在 serverlast—ack 状态还没收到 client1 最终确认 ack 之前，client2 以相同端口接入网络
            - client2 开始和 server 正常建立连接
            - server 也认为是合法的可以和 client2 正常通信，则 client1 的连接没有关闭
        3. 为什么是 2 * MSL
            - 等待 2 * MSL 时间主要目的是怕最后一个 ACK 包对方没收到，那么对方在超时后将重发第三次握手的 FIN 包
            - 主动关闭端接到重发的 FIN 包后可以再发一个 ACK 应答包


### 三层隔离有哪些？
    - 物理隔离
    - 逻辑隔离
        - 虚拟局域网VLAN
        - 多协议标签转换（MPLS）
        - 虚拟交换机
### https如何加解密
    - 请求网址
    - server返回证书公钥
    - client段对证书进行是否有效
    - client浏览器无效弹出警告
    - client有效-则生成一个随机值
    - client用证书的公钥加密随机值
    - server将加密后的密钥发给服务端
    - server用私钥解密密钥
    - server取出密钥
    - server用密钥加密要发送的内容
    - client端用密钥解密信息
### SSL/TLS协议提供的服务主要
    - 认证用户和服务器，确保数据发送到正确的客户机和服务器
    - 加密数据以防止数据中途被窃取
    - 维护数据的完整性，确保数据在传输过程中不被改变
### tls原理
    - Transport Layer Security
    - 它建立在SSL 3.0协议规范之上，是SSL 3.0的后续版本
### 密钥协商过程——TLS握手
    - 客户端发出请求
        - 户端首先要告知服务端，自己支持哪些加密算法，将本地支持的加密套件(Cipher Suite)的列表传送给服务端
        - 提供协议版本，随机数，支持的加密算法，支持的压缩算法
    - 服务器回应（SeverHello)
        - 确认使用的加密通信协议版本，比如TLS 1.0版本。如果浏览器与服务器支持的版本不一致，服务器关闭加密通信'
        - 一个服务器生成的随机数，稍后用于生成"对话密钥"
        - 确认使用的加密方法，比如RSA公钥加密
        - 服务器证书
    - 客户端回应
        - 客户端需要对服务端的证书进行检查，如果证书不是可信机构颁布、或者证书中的域名与实际域名不一致、或者证书已经过期，就会向访问者显示一个警告
        - 证书没有问题，客户端就会从服务器证书中取出服务器的公钥;向服务器发送下面三项信息
            - 一个随机数。该随机数用服务器公钥加密，防止被窃听
            - 编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送
            - 客户端握手结束通知，表示客户端的握手阶段已经结束
    - 服务器的最后回应（Server Finish)

### ssl原理
    - 用以保障在Internet上数据传输之安全，利用数据加密(Encryption)技术，可确保数据在网络上之传输过程中不会被截取
    - Secure Socket Layer
    - SSL协议可分为两层
        - SSL记录协议（SSL Record Protocol）：它建立在可靠的传输协议（如TCP）之上，为高层协议提供数据封装、压缩、加密等基本功能的支持
        - SSL握手协议（SSL Handshake Protocol）：它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等

### 请求baidu.com 发生了什么
    - 域名解析
    - tcp/ip握手
    - 发送http请求
    - 服务器相应http请求
    - 浏览器解析相应的资源
    - 浏览器对页面进行渲染反馈给用户
    - [图解](https://static001.geekbang.org/resource/image/8a/19/8a5bddd3d8046daf7032c7d60a3d1a19.png)

### rpc和http的区别
    - RPC
        - 致力于通过http协议中的POST/GET/PUT/DELETE等方法和一个可读性强的URL来提供一个http请求
        - RPC架构四个核心的组件，分别是Client 、Server、Client Stub以及Server Stub
        - RPC框架要做到的最基本的三件事
            - 服务端如何确定客户端要调用的函数
            - 如何进行序列化和反序列化
            - 如何进行网络传输（选择何种网络协议）
        - 减少了网络开销,不必每次都进行握手
        -  RPC框架一般都有注册中心，有丰富的监控管理；发布、下线接口、动态扩展等，对调用方来说是无感知、统一化的操作
    - http/rest
        - REST是一种架构风格，指的是一组架构约束条件和原则
        - RESTful规范把所有内容都视为资源，网络上一切皆资源
        - 可以完全通过 HTTP协议实现，使用 HTTP 协议处理数据通信
        - REST架构对资源的操作包括获取、创建、修改和删除资源的操作正好对应 HTTP协议提供的GET、POST、PUT和 DELETE方法
### http 1.1 和http 2.0的区别
    - [http 1.1 和http 2.0的区别](https://www.cnblogs.com/heluan/p/8620312.html)   
### http etag请求头的作用
### http1.1 保持长连接
    - [http1.1 保持长连接](https://blog.csdn.net/xiaoduanayu/article/details/78386508)
### https与http的区别
    - - [https与http的区别](https://www.cnblogs.com/wqhwe/p/5407468.html)
### 滑动窗口的概念以及应用?
### 三次握手四次挥手过程
### mysql一个表有时间，用户，消息字段要求查每个用户最新一条消息
### 如果tcp握手没成功怎么办
    - 如果第一次握手没成功
        - 在 Linux 里，客户端的 SYN 报文最大重传次数由 tcp_syn_retries内核参数控制，这个参数是可以自定义的，默认值一般是 5
        - 第一次超时重传是在 1 秒后，第二次超时重传是在 2 秒，第三次超时重传是在 4 秒后，第四次超时重传是在 8 秒后，第五次是在超时重传 16 秒后。没错，每次超时的时间是上一次的 2 倍
        - 当第五次超时重传后，会继续等待 32 秒，如果服务端仍然没有回应 ACK，客户端就不再发送 SYN 包，然后断开 TCP 连接
    - 第二次握手丢失了，会发生什么
        - 服务端会进入 SYN_RCVD 状态
        - 客户端就会触发超时重传机制，重传 SYN 报文，因为客户端就觉得可能自己的 SYN 报文（第一次握手）丢失了。

### auth2权限认证
    [reference](https://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.html)
### tcp怎么实现可靠的通信
### tcp拥塞控制算？为什么需要拥塞避免？
### cookie可以设置什么？
    - http only ， domain ， key value，expire

### 网络攻击,ddos攻击, 半连接攻击
### websocket?
### http2.0实现原理
    - [refer](https://www.processon.com/view/link/62144beb079129079ad7665f)

### TCP三次握手，为什么需要? 如果第二次或者第三次握手去掉，会怎么样？
    - 第二次和第三次握手是彼此确认发送消息的序列号，以方便通信进行序列号确认，
    - 如果去掉就会影响后续ack机制

- 数据链层数据转发原理？
- 物理层是什么机制？
- 网络延迟对服务器造成什么影响
- 内存同步中间件过程中宕机，怎么办？
- tcp timewait发生在哪里
- JWT有什么缺点?
- tcp链接
    - [refer](https://mp.weixin.qq.com/s/X6c_H5_4OInR8nFQVn7IMA)